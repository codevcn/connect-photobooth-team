<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Element A theo B - Fixed Offset</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f0f0f0;
      }

      .controls {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .control-group {
        margin-bottom: 15px;
      }

      label {
        display: inline-block;
        width: 150px;
        font-weight: bold;
      }

      input[type='range'] {
        width: 200px;
        vertical-align: middle;
      }

      input[type='number'] {
        width: 80px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
      }

      button:hover {
        background: #0056b3;
      }

      .container-wrapper {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: inline-block;
      }

      #container {
        position: relative;
        width: 600px;
        height: 400px;
        background: #e9ecef;
        border: 2px solid #495057;
        transform-origin: top left;
        transition: transform 0.3s ease;
      }

      .element {
        position: absolute;
        transition: all 0.3s ease;
        cursor: move;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 18px;
      }

      #elementA {
        background: rgba(220, 53, 69, 0.8);
        border: 2px solid #dc3545;
        width: 50px;
        height: 50px;
        left: 119px; /* 100 + 19 */
        top: 123px; /* 100 + 23 */
      }

      #elementB {
        background: rgba(40, 167, 69, 0.8);
        border: 2px solid #28a745;
        width: 150px;
        height: 100px;
        left: 100px;
        top: 100px;
      }

      .info {
        background: #fff3cd;
        padding: 15px;
        border-radius: 4px;
        margin-top: 20px;
        border-left: 4px solid #ffc107;
      }

      .relative-info {
        background: #d1ecf1;
        padding: 15px;
        border-radius: 4px;
        margin-top: 10px;
        border-left: 4px solid #17a2b8;
        font-family: monospace;
        white-space: pre-line;
      }

      .visual-guide {
        position: absolute;
        border: 1px dashed #666;
        pointer-events: none;
        z-index: 10;
      }

      .guide-horizontal {
        height: 1px;
        background: #666;
      }

      .guide-vertical {
        width: 1px;
        background: #666;
      }
    </style>
  </head>
  <body>
    <h1>Demo: Element A giữ khoảng cách cố định với mép của Element B</h1>

    <div class="controls">
      <div class="control-group">
        <label>Scale Container:</label>
        <input type="range" id="scaleSlider" min="0.5" max="2" step="0.1" value="1" />
        <span id="scaleValue">1.0</span>
      </div>

      <div class="control-group">
        <label>B - X Position:</label>
        <input type="number" id="bX" value="100" min="0" max="500" />
      </div>

      <div class="control-group">
        <label>B - Y Position:</label>
        <input type="number" id="bY" value="100" min="0" max="300" />
      </div>

      <div class="control-group">
        <label>B - Width:</label>
        <input type="number" id="bWidth" value="150" min="50" max="300" />
      </div>

      <div class="control-group">
        <label>B - Height:</label>
        <input type="number" id="bHeight" value="100" min="50" max="300" />
      </div>

      <div class="control-group">
        <button onclick="applyChanges()">Áp dụng thay đổi</button>
        <button onclick="resetPositions()">Reset</button>
        <button onclick="demoResize()">Demo Resize</button>
        <button onclick="demoMove()">Demo Move</button>
      </div>
    </div>

    <div class="container-wrapper">
      <div id="container">
        <div id="elementA" class="element">A</div>
        <div id="elementB" class="element">B</div>
      </div>
    </div>

    <div class="relative-info" id="relativeInfo">Vị trí tương đối: đang tính toán...</div>

    <div class="info">
      <h3>Hướng dẫn:</h3>
      <ul>
        <li>
          Element A (đỏ) giữ <strong>khoảng cách PIXEL cố định</strong> từ mép trái và mép trên của
          B
        </li>
        <li>Khi B thay đổi kích thước, A vẫn cách mép trái B là 19px và mép trên B là 23px</li>
        <li>Khi B di chuyển, A cũng di chuyển theo để giữ vị trí tương đối</li>
        <li>Thử thay đổi kích thước B để thấy A luôn giữ khoảng cách cố định!</li>
      </ul>
    </div>

    <script>
      // Khoảng cách cố định từ A đến mép của B
      const FIXED_OFFSET_LEFT = 19 // px từ mép trái B
      const FIXED_OFFSET_TOP = 23 // px từ mép trên B

      let initialAState = null
      let initialBState = null
      let offsetLeft = FIXED_OFFSET_LEFT // Khoảng cách từ mép trái B đến A
      let offsetTop = FIXED_OFFSET_TOP // Khoảng cách từ mép trên B đến A

      function getElementState(element) {
        return {
          x: parseFloat(element.style.left) || element.offsetLeft,
          y: parseFloat(element.style.top) || element.offsetTop,
          width: element.offsetWidth,
          height: element.offsetHeight,
        }
      }

      function applyPositionToDOM(element, state) {
        element.style.left = `${state.x}px`
        element.style.top = `${state.y}px`
        if (state.width > 0) element.style.width = `${state.width}px`
        if (state.height > 0) element.style.height = `${state.height}px`
      }

      // Tính khoảng cách từ A đến mép trái và mép trên của B
      function calculateFixedOffset(elementA, elementB) {
        // Khoảng cách từ mép trái B đến mép trái A
        const offsetLeft = elementA.x - elementB.x

        // Khoảng cách từ mép trên B đến mép trên A
        const offsetTop = elementA.y - elementB.y

        return { offsetLeft, offsetTop }
      }

      // Tính vị trí mới của A dựa trên vị trí và kích thước mới của B
      // A sẽ luôn cách mép trái B là offsetLeft px và mép trên B là offsetTop px
      function calculateNewAPosition(newBState, offsetLeft, offsetTop) {
        // Vị trí mới của A = vị trí B + offset cố định
        const newX = newBState.x + offsetLeft
        const newY = newBState.y + offsetTop

        return { x: newX, y: newY }
      }

      // Hàm chính: Di chuyển A theo B với khoảng cách cố định từ mép
      function moveElementAWithB(currentAState, currentBState, newBState) {
        // Tính khoảng cách hiện tại (hoặc dùng offset đã lưu)
        const { offsetLeft, offsetTop } = calculateFixedOffset(currentAState, currentBState)

        // Tính vị trí mới của A
        const newAPosition = calculateNewAPosition(newBState, offsetLeft, offsetTop)

        return {
          ...currentAState,
          x: newAPosition.x,
          y: newAPosition.y,
        }
      }

      function updateRelativeInfo() {
        if (!initialAState || !initialBState) return

        const { offsetLeft, offsetTop } = calculateFixedOffset(initialAState, initialBState)

        let infoText = `Vị trí tương đối của A so với B:\n`
        infoText += `• Cách mép trái B: ${offsetLeft.toFixed(1)}px\n`
        infoText += `• Cách mép trên B: ${offsetTop.toFixed(1)}px\n`
        infoText += `\nVị trí tuyệt đối:\n`
        infoText += `• A: (${initialAState.x.toFixed(1)}, ${initialAState.y.toFixed(1)})\n`
        infoText += `• B: (${initialBState.x.toFixed(1)}, ${initialBState.y.toFixed(1)})\n`
        infoText += `\nKích thước B:\n`
        infoText += `• Width: ${initialBState.width}px, Height: ${initialBState.height}px`

        document.getElementById('relativeInfo').textContent = infoText
      }

      // Event handlers
      const scaleSlider = document.getElementById('scaleSlider')
      const scaleValue = document.getElementById('scaleValue')
      const container = document.getElementById('container')
      const elementA = document.getElementById('elementA')
      const elementB = document.getElementById('elementB')

      scaleSlider.addEventListener('input', function () {
        const scale = parseFloat(this.value)
        scaleValue.textContent = scale.toFixed(1)
        container.style.transform = `scale(${scale})`
      })

      function applyChanges() {
        const newBState = {
          x: parseFloat(document.getElementById('bX').value),
          y: parseFloat(document.getElementById('bY').value),
          width: parseFloat(document.getElementById('bWidth').value),
          height: parseFloat(document.getElementById('bHeight').value),
        }

        if (!initialAState || !initialBState) {
          initialAState = getElementState(elementA)
          initialBState = getElementState(elementB)
        }

        // Tính vị trí mới của A - giữ khoảng cách cố định từ mép B
        const newAState = moveElementAWithB(initialAState, initialBState, newBState)

        // Áp dụng lên DOM
        applyPositionToDOM(elementB, newBState)
        applyPositionToDOM(elementA, newAState)

        // Cập nhật initial states
        initialAState = getElementState(elementA)
        initialBState = getElementState(elementB)

        updateRelativeInfo()
      }

      function resetPositions() {
        // Reset B
        elementB.style.left = '100px'
        elementB.style.top = '100px'
        elementB.style.width = '150px'
        elementB.style.height = '100px'

        // Reset A - cách mép trái B là 19px, mép trên B là 23px
        elementA.style.left = '119px' // 100 + 19
        elementA.style.top = '123px' // 100 + 23
        elementA.style.width = '50px'
        elementA.style.height = '50px'

        document.getElementById('bX').value = 100
        document.getElementById('bY').value = 100
        document.getElementById('bWidth').value = 150
        document.getElementById('bHeight').value = 100

        scaleSlider.value = 1
        scaleValue.textContent = '1.0'
        container.style.transform = 'scale(1)'

        initialAState = getElementState(elementA)
        initialBState = getElementState(elementB)

        updateRelativeInfo()
      }

      function demoResize() {
        const steps = [
          { x: 100, y: 100, w: 200, h: 150, delay: 500 },
          { x: 100, y: 100, w: 250, h: 100, delay: 1000 },
          { x: 100, y: 100, w: 100, h: 200, delay: 1500 },
          { x: 100, y: 100, w: 150, h: 100, delay: 2000 },
        ]

        steps.forEach((step) => {
          setTimeout(() => {
            document.getElementById('bX').value = step.x
            document.getElementById('bY').value = step.y
            document.getElementById('bWidth').value = step.w
            document.getElementById('bHeight').value = step.h
            applyChanges()
          }, step.delay)
        })
      }

      function demoMove() {
        const steps = [
          { x: 200, y: 150, w: 150, h: 100, delay: 500 },
          { x: 300, y: 200, w: 150, h: 100, delay: 1000 },
          { x: 150, y: 80, w: 150, h: 100, delay: 1500 },
          { x: 100, y: 100, w: 150, h: 100, delay: 2000 },
        ]

        steps.forEach((step) => {
          setTimeout(() => {
            document.getElementById('bX').value = step.x
            document.getElementById('bY').value = step.y
            document.getElementById('bWidth').value = step.w
            document.getElementById('bHeight').value = step.h
            applyChanges()
          }, step.delay)
        })
      }

      // Khởi tạo
      window.onload = function () {
        resetPositions()
      }
    </script>
  </body>
</html>
